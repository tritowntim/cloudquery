
<%= render partial: 'databases/list', locals: { databases: @databases, id: @database.id, sibling_path: "database_queries_path" } %>

<em>&nbsp;&nbsp;&nbsp;<%= link_to "new query", new_database_query_path(@database) %></em>

<table class="query-index">
	<thead>
		<tr>
			<th>ID</th>
			<th>Execution Time</th>
			<th>Duration</th>
			<th>Resultset<br>Record<br>Count</th>
			<th>SQL</th>
			<th>Exception Class</th>
			<th>Exception</th>
			<th>Notes</th>
		</tr>
	</thead>
	<tbody>
		<% @queries.each do |query| %>
			<tr>
				<td>
						<%= link_to query.id, database_query_path(@database, query) %>
				</td>
				<td>
						<%= "#{query.created_at.to_formatted_s(:db)}" %>
				</td>
				<td>
					<%= "#{number_with_precision(query.duration_ms.to_f / 1000, precision: 3, delimiter: ',')}" %>
				</td>
				<td>
					<%= "#{number_with_delimiter(query.record_count)}" %>
				</td>
				<td>
					<span class="query-read-only-sql-text">
						<%= simple_format(query.sql_text) %>
					</span>
				</td>
				<td>
					<%= query.pg_exception_class %>
				</td>
				<td>
					<%= query.pg_exception %>
				</td>
				<td>
					<%= render partial: 'notes', locals: { database: @database, query: query } %>
				</td>
			</tr>
		<% end %>
	</tbody>
</table>
